{"nodes":[{"parameters":{},"id":"7d582f5b-c4c2-4d68-a26a-2f77f45c7e94","name":"ğŸ¯ Execute Workflow Trigger","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1,"position":[-128,176]},{"parameters":{"content":"## ğŸ¨ GÃ©nÃ©ration d'Assets Visuels\n\n**EntrÃ©es :**\n- projectId\n- SÃ©quences (depuis Module 2)\n\n**Actions :**\n1. Lire sÃ©quences\n2. Boucle sur chaque sÃ©quence\n3. CrÃ©er prompt image\n4. GÃ©nÃ©rer image (Kie.ai)\n5. Option: GÃ©nÃ©rer vidÃ©o courte\n6. Upload Google Drive\n7. Sauvegarder mÃ©tadonnÃ©es\n\n**Sorties :**\n- Images pour chaque sÃ©quence\n- URLs dans Google Sheets","height":420,"width":350,"color":3},"id":"6371e9c3-be91-46f6-8e1c-31fdf81ea025","name":"ğŸ¨ MODULE 3 - ASSETS VISUELS","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-320,-32]},{"parameters":{"operation":"getAll","documentId":{"__rl":true,"mode":"id","value":"={{ $json.spreadsheetId }}"}},"id":"f202f303-ad54-4fec-96be-a158b6e3c17e","name":"ğŸ“– Lire SÃ©quences","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[128,176]},{"parameters":{"options":{}},"id":"98bb4d79-e8b2-473a-83f0-0e2329ca69c2","name":"ğŸ”„ Boucle SÃ©quences","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[368,176]},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/chat/completions","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"gpt-4\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"Tu crÃ©es des prompts DALL-E/Stable Diffusion. Style: moderne, professionnel, 16:9.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"CrÃ©e un prompt pour illustrer: {{ $json.text }}\\n\\nSection: {{ $json.section }}\\n\\nRetourne UNIQUEMENT le prompt, rien d'autre.\"\n    }\n  ],\n  \"temperature\": 0.8,\n  \"max_tokens\": 150\n}","options":{}},"id":"7522fbbd-d57f-4c0e-9944-6530711abf32","name":"ğŸ’­ GPT-4 - CrÃ©er Prompt Image","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[608,176]},{"parameters":{"method":"POST","url":"https://api.kie.ai/v1/images/generate","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"prompt\": \"{{ $('ğŸ’­ GPT-4 - CrÃ©er Prompt Image').first().json.choices[0].message.content }}\",\n  \"model\": \"flux-pro\",\n  \"width\": 1920,\n  \"height\": 1080,\n  \"num_outputs\": 1,\n  \"output_format\": \"png\"\n}","options":{"response":{"response":{"responseFormat":"file"}}}},"id":"39775216-039f-4dea-9be6-8ddd68a4aac6","name":"ğŸ–¼ï¸ Kie.ai - GÃ©nÃ©rer Image","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[848,176]},{"parameters":{"name":"={{ 'seq_' + $('ğŸ”„ Boucle SÃ©quences').item.json.sequenceId + '.png' }}","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"mode":"list","value":"root","cachedResultName":"/ (Root folder)"},"options":{}},"id":"eaaa8057-cb46-45d9-8f50-d1ca73c8bd7e","name":"â˜ï¸ Drive - Upload Image","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1088,176]},{"parameters":{"operation":"update","documentId":{"__rl":true,"mode":"id","value":"={{ $('ğŸ¯ Execute Workflow Trigger').item.json.spreadsheetId }}"},"sheetName":{"__rl":true,"mode":"list","value":"Sequences"},"columns":{"mappingMode":"defineBelow","value":{"imageUrl":"={{ $('â˜ï¸ Drive - Upload Image').first().json.webViewLink }}","imageId":"={{ $('â˜ï¸ Drive - Upload Image').first().json.id }}","status":"image_done"}},"options":{}},"id":"4d531259-141a-405a-96ec-f2c4c549eafd","name":"âœ… Mettre Ã  jour SÃ©quence","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1328,176]},{"parameters":{"conditions":{"options":{"version":2},"combinator":"and","conditions":[{"id":"has-more","leftValue":"={{ $('ğŸ”„ Boucle SÃ©quences').context.noItemsLeft }}","rightValue":false,"operator":{"type":"boolean","operation":"equals"}}]},"options":{}},"id":"6a6a953e-475d-4b35-99f3-cc4df282e59e","name":"ğŸ” Continuer Boucle?","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1568,176]},{"parameters":{"assignments":{"assignments":[{"id":"status","name":"status","type":"string","value":"success"},{"id":"module","name":"module","type":"string","value":"visuals"},{"id":"project-id","name":"projectId","type":"string","value":"={{ $('ğŸ¯ Execute Workflow Trigger').item.json.projectId }}"},{"id":"images-generated","name":"imagesGenerated","type":"number","value":"={{ $('ğŸ“– Lire SÃ©quences').all().length }}"}]},"options":{}},"id":"3a61f28c-1249-485b-88d2-0605736ae0dd","name":"âœ… Retourner RÃ©sultat","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1808,320]},{"parameters":{"content":"## VidÃ©o Courte (Optionnel)\n\nPour sÃ©quences > 6 secondes:\n- GÃ©nÃ©rer vidÃ©o avec Kie.ai\n- API: runway-gen3\n- Upload Drive\n- Update Sequences sheet\n\nDÃ©sactivÃ© par dÃ©faut pour Ã©conomiser coÃ»ts","height":220,"width":300,"color":7},"id":"872d3cf9-9140-4b1e-84c8-5fbc002fb392","name":"ğŸ¥ GÃ©nÃ©ration VidÃ©o Optionnelle","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[592,368]}],"connections":{"ğŸ¯ Execute Workflow Trigger":{"main":[[{"node":"ğŸ“– Lire SÃ©quences","type":"main","index":0}]]},"ğŸ“– Lire SÃ©quences":{"main":[[{"node":"ğŸ”„ Boucle SÃ©quences","type":"main","index":0}]]},"ğŸ”„ Boucle SÃ©quences":{"main":[[{"node":"ğŸ’­ GPT-4 - CrÃ©er Prompt Image","type":"main","index":0}],[{"node":"âœ… Retourner RÃ©sultat","type":"main","index":0}]]},"ğŸ’­ GPT-4 - CrÃ©er Prompt Image":{"main":[[{"node":"ğŸ–¼ï¸ Kie.ai - GÃ©nÃ©rer Image","type":"main","index":0}]]},"ğŸ–¼ï¸ Kie.ai - GÃ©nÃ©rer Image":{"main":[[{"node":"â˜ï¸ Drive - Upload Image","type":"main","index":0}]]},"â˜ï¸ Drive - Upload Image":{"main":[[{"node":"âœ… Mettre Ã  jour SÃ©quence","type":"main","index":0}]]},"âœ… Mettre Ã  jour SÃ©quence":{"main":[[{"node":"ğŸ” Continuer Boucle?","type":"main","index":0}]]},"ğŸ” Continuer Boucle?":{"main":[[{"node":"ğŸ”„ Boucle SÃ©quences","type":"main","index":0}],[{"node":"âœ… Retourner RÃ©sultat","type":"main","index":0}]]}},"pinData":{},"meta":null}