{"nodes":[{"parameters":{"path":"youtube-phase1-recherche","responseMode":"lastNode","options":{}},"id":"3c2b5db8-edee-4db5-b0a9-6ee3f70f7a37","name":"ğŸ¯ Trigger Phase 1","type":"n8n-nodes-base.webhook","position":[32,304],"webhookId":"phase1-recherche-webhook","typeVersion":1.1},{"parameters":{"content":"## ğŸ” PHASE 1: RECHERCHE & SCRAPING\n\n**Agent**: Research Orchestrator\n\n**Inputs attendus**:\n- project_name\n- topic\n- competitor_channels\n- num_videos_to_analyze\n\n**Outputs produits**:\n- sheets_url (Google Sheets avec donnÃ©es)\n- summary_stats (JSON)\n- status (success/error)","height":260,"width":420,"color":4},"id":"d200100b-60af-44a9-a888-9eca65511e5c","name":"ğŸ“‹ PHASE 1: RECHERCHE & SCRAPING","type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1},{"parameters":{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"input-001","operator":{"type":"string","operation":"exists"},"leftValue":"={{$json.body.project_name}}"},{"id":"input-002","operator":{"type":"string","operation":"exists"},"leftValue":"={{$json.body.topic}}"}]},"options":{}},"id":"f01c9c79-335a-4fac-a3e8-056760e3eaa2","name":"âœ… Valider Inputs","type":"n8n-nodes-base.if","position":[240,304],"typeVersion":2},{"parameters":{"respondWith":"json","responseBody":"={\n  \"status\": \"error\",\n  \"phase\": \"Phase 1 - Recherche\",\n  \"error_message\": \"Inputs manquants: project_name et topic sont requis\",\n  \"timestamp\": \"{{$now}}\"\n}","options":{"responseCode":400}},"id":"cbc08ae0-08ae-4b6e-8c5b-d6bc462617b3","name":"âŒ Inputs Invalides","type":"n8n-nodes-base.respondToWebhook","position":[240,512],"typeVersion":1.1},{"parameters":{"assignments":{"assignments":[{"id":"cfg-001","name":"project_name","type":"string","value":"={{$json.body.project_name}}"},{"id":"cfg-002","name":"topic","type":"string","value":"={{$json.body.topic}}"},{"id":"cfg-003","name":"competitor_channels","type":"string","value":"={{$json.body.competitor_channels || ''}}"},{"id":"cfg-004","name":"num_videos_to_analyze","type":"number","value":"={{$json.body.num_videos_to_analyze || 20}}"},{"id":"cfg-005","name":"execution_id","type":"string","value":"={{$json.body.execution_id || $now.format('yyyyMMdd_HHmmss')}}"}]},"options":{}},"id":"3d243b56-2135-41d3-ac92-9b9f7cabd13f","name":"âš™ï¸ Extraire Configuration","type":"n8n-nodes-base.set","position":[464,208],"typeVersion":3.4},{"parameters":{"method":"POST","url":"https://api.apify.com/v2/acts/apify~youtube-scraper/runs","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"={{$credentials.apifyApiKey}}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"searchKeywords\": \"{{$json.topic}}\",\n  \"maxResults\": {{$json.num_videos_to_analyze}},\n  \"scrapeVideoInfo\": true,\n  \"scrapeVideoTranscripts\": true,\n  \"scrapeVideoComments\": false\n}","options":{}},"id":"14c8946b-75a7-48ca-93d6-fbab43011947","name":"ğŸ” Apify - Scraper YouTube","type":"n8n-nodes-base.httpRequest","position":[704,208],"typeVersion":4.2},{"parameters":{"amount":30},"id":"4c271e30-33ac-4249-aaac-4bb791651be8","name":"â³ Attendre Scraping","type":"n8n-nodes-base.wait","position":[944,208],"typeVersion":1.1,"webhookId":"1e938cf7-8e72-4b17-aa8c-5828159debb0"},{"parameters":{"url":"=https://api.apify.com/v2/actor-runs/{{$json.data.id}}/dataset/items","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"token","value":"={{$credentials.apifyApiKey}}"},{"name":"format","value":"json"}]},"options":{}},"id":"b7146fb3-e33e-4b7f-8b1a-b4c039ace99e","name":"ğŸ“¥ RÃ©cupÃ©rer RÃ©sultats","type":"n8n-nodes-base.httpRequest","position":[1184,208],"typeVersion":4.2},{"parameters":{"jsCode":"// Transformer les donnÃ©es Apify en format structurÃ©\nconst projectName = $('âš™ï¸ Extraire Configuration').first().json.project_name;\nconst items = $input.all();\n\nconst transcripts = [];\nconst thumbnails = [];\nconst keywords = new Set();\n\nfor (const item of items) {\n  const data = item.json;\n  \n  if (data.transcript) {\n    transcripts.push({\n      video_url: data.url,\n      title: data.title,\n      transcript: data.transcript,\n      duration: data.duration,\n      views: data.viewCount || 0,\n      likes: data.likeCount || 0\n    });\n  }\n  \n  if (data.thumbnails && data.thumbnails.length > 0) {\n    thumbnails.push({\n      thumbnail_url: data.thumbnails[0].url,\n      video_title: data.title,\n      views: data.viewCount || 0,\n      ctr_estimated: data.viewCount > 0 ? Math.round((data.likeCount / data.viewCount) * 100 * 100) / 100 : 0\n    });\n  }\n  \n  if (data.keywords) {\n    data.keywords.forEach(kw => keywords.add(kw));\n  }\n}\n\nconst summary = {\n  total_videos_analyzed: items.length,\n  transcripts_count: transcripts.length,\n  thumbnails_count: thumbnails.length,\n  keywords_count: keywords.size,\n  avg_duration: transcripts.length > 0 ? transcripts.reduce((sum, t) => sum + t.duration, 0) / transcripts.length : 0,\n  avg_views: transcripts.length > 0 ? transcripts.reduce((sum, t) => sum + t.views, 0) / transcripts.length : 0\n};\n\nreturn [\n  {\n    json: {\n      project_name: projectName,\n      transcripts: transcripts,\n      thumbnails: thumbnails,\n      keywords: Array.from(keywords).map(kw => ({\n        keyword: kw,\n        search_volume: 0,\n        competition: 'unknown'\n      })),\n      summary: summary\n    }\n  }\n];"},"id":"496d7c9f-28f6-4941-9e01-aebc23558baf","name":"ğŸ”„ Transformer DonnÃ©es","type":"n8n-nodes-base.code","position":[1424,208],"typeVersion":2},{"parameters":{"operation":"create","documentId":{"__rl":true,"mode":"list","value":""},"options":{}},"id":"aaa0b96f-98c9-4371-beed-8e31ad54e801","name":"ğŸ“Š CrÃ©er Google Sheets","type":"n8n-nodes-base.googleSheets","position":[1664,208],"typeVersion":4.4},{"parameters":{"jsCode":"// PrÃ©parer les transcripts pour Google Sheets\nconst data = $input.first().json;\nconst transcripts = data.transcripts;\n\nreturn transcripts.map(t => ({ json: t }));"},"id":"2489da98-92b5-4247-8839-311738bcac57","name":"ğŸ“ Sauvegarder Transcripts","type":"n8n-nodes-base.code","position":[1904,112],"typeVersion":2},{"parameters":{"operation":"append","documentId":{"__rl":true,"mode":"id","value":"={{$('ğŸ“Š CrÃ©er Google Sheets').item.json.spreadsheetId}}"},"sheetName":{"__rl":true,"mode":"name","value":"transcripts"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":[],"schema":[]},"options":{}},"id":"fd541112-bb90-4f6b-9b8e-b150f5d1c045","name":"â• Append Transcripts","type":"n8n-nodes-base.googleSheets","position":[2144,112],"typeVersion":4.4},{"parameters":{"assignments":{"assignments":[{"id":"resp-001","name":"status","type":"string","value":"success"},{"id":"resp-002","name":"phase","type":"string","value":"Phase 1 - Recherche & Scraping"},{"id":"resp-003","name":"outputs","type":"object","value":"={\n  \"sheets_url\": \"https://docs.google.com/spreadsheets/d/{{$('ğŸ“Š CrÃ©er Google Sheets').item.json.spreadsheetId}}\",\n  \"spreadsheet_id\": \"{{$('ğŸ“Š CrÃ©er Google Sheets').item.json.spreadsheetId}}\",\n  \"summary_stats\": {{$('ğŸ”„ Transformer DonnÃ©es').item.json.summary.toJsonString()}}\n}"},{"id":"resp-004","name":"timestamp","type":"string","value":"={{$now}}"},{"id":"resp-005","name":"execution_id","type":"string","value":"={{$('âš™ï¸ Extraire Configuration').first().json.execution_id}}"}]},"options":{}},"id":"58b0d68b-31fb-4d63-b808-b91be6655941","name":"ğŸ“¦ Construire RÃ©ponse","type":"n8n-nodes-base.set","position":[2384,208],"typeVersion":3.4},{"parameters":{"respondWith":"json","responseBody":"={{$json}}","options":{"responseCode":200}},"id":"c049516e-b9fa-4ecf-87b4-b21c55555053","name":"âœ… RÃ©ponse SuccÃ¨s","type":"n8n-nodes-base.respondToWebhook","position":[2624,208],"typeVersion":1.1},{"parameters":{"assignments":{"assignments":[{"id":"err-001","name":"status","type":"string","value":"error"},{"id":"err-002","name":"phase","type":"string","value":"Phase 1 - Recherche & Scraping"},{"id":"err-003","name":"error_message","type":"string","value":"={{$json.error?.message || 'Erreur inconnue'}}"},{"id":"err-004","name":"timestamp","type":"string","value":"={{$now}}"}]},"options":{}},"id":"e537bec9-e46e-4a52-9bbb-ea6d15f133b6","name":"âš ï¸ Capturer Erreur","type":"n8n-nodes-base.set","position":[2384,400],"typeVersion":3.4},{"parameters":{"respondWith":"json","responseBody":"={{$json}}","options":{"responseCode":500}},"id":"9733c934-f904-47e0-abfd-386737b98b4a","name":"âŒ RÃ©ponse Erreur","type":"n8n-nodes-base.respondToWebhook","position":[2624,400],"typeVersion":1.1},{"parameters":{"content":"## ğŸ” PHASE 1: RECHERCHE & SCRAPING + KIMI K2\n\n**Agent**: Research Orchestrator + Kimi K2 Post-Processor\n\n**Inputs attendus**:\n- project_name\n- topic\n- competitor_channels\n- num_videos_to_analyze\n- target_audience (nouveau)\n\n**Outputs produits**:\n- sheets_url (Google Sheets avec donnÃ©es)\n- cleaned_videos (JSON structurÃ© par Kimi K2)\n- global_insights (patterns identifiÃ©s)\n- competitive_gaps (opportunitÃ©s)\n- status (success/error)","height":320,"width":480,"color":4},"id":"fcade15b-a429-4bb5-a37e-69a5266d4013","name":"ğŸ“‹ PHASE 1: RECHERCHE & SCRAPING + KIMI K2","type":"n8n-nodes-base.stickyNote","position":[16,816],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"prompt-001","name":"apify_raw_data","type":"string","value":"={{JSON.stringify($json)}}"},{"id":"prompt-002","name":"topic","type":"string","value":"={{$('âš™ï¸ Extraire Configuration1').first().json.topic}}"},{"id":"prompt-003","name":"target_audience","type":"string","value":"={{$('âš™ï¸ Extraire Configuration1').first().json.target_audience}}"},{"id":"prompt-004","name":"num_videos","type":"number","value":"={{$('âš™ï¸ Extraire Configuration1').first().json.num_videos_to_analyze}}"},{"id":"prompt-005","name":"system_prompt","type":"string","value":"Tu es DATA_PROCESSOR_PHASE1, expert en nettoyage et enrichissement de donnÃ©es YouTube.\n\n### RÃ”LE\nTransformer les donnÃ©es BRUTES Apify en donnÃ©es STRUCTURÃ‰ES exploitables pour Phase 2.\n\n### TÃ‚CHES PRÃ‰CISES\n1. **Nettoyer** : Supprimer doublons, corriger formats, valider donnÃ©es\n2. **Enrichir** : Extraire patterns (durÃ©e, hooks, thumbnails)\n3. **Classifier** : CatÃ©goriser vidÃ©os (Tutorial, Listicle, Storytelling, etc.)\n4. **Analyser hooks** : Identifier type de hook utilisÃ©\n5. **GÃ©nÃ©rer insights** : Top 5 patterns + 2-3 gaps d'opportunitÃ©\n\n### FORMAT SORTIE - JSON STRICT\nRetourner un JSON valide avec cette structure exacte :\n{\n  \"processing_status\": \"success\",\n  \"cleaned_videos\": [...],\n  \"global_insights\": {...},\n  \"competitive_gaps\": {...},\n  \"recommendations\": {...}\n}\n\nRÃˆGLES STRICTES:\n- NE PAS inventer de donnÃ©es\n- Calculer engagement_rate = (likes+comments)/views*100\n- Toujours classifier mÃªme si incertain\n- Retourner JSON valide uniquement"},{"id":"prompt-006","name":"user_prompt","type":"string","value":"=NETTOYAGE DONNÃ‰ES APIFY - PHASE 1:\n\n=== CONFIGURATION ===\nTopic: \"{{$('âš™ï¸ Extraire Configuration1').first().json.topic}}\"\nTarget Audience: \"{{$('âš™ï¸ Extraire Configuration1').first().json.target_audience}}\"\nVideos to Analyze: {{$('âš™ï¸ Extraire Configuration1').first().json.num_videos_to_analyze}}\n\n=== DONNÃ‰ES BRUTES APIFY ===\n{{JSON.stringify($json)}}\n\n=== INSTRUCTIONS ===\n1. Nettoie les donnÃ©es (doublons, formats)\n2. Enrichis avec calculs (engagement_rate, days_ago)\n3. Classifie chaque vidÃ©o (type + hook + thumbnail)\n4. Analyse patterns globaux\n5. Identifie 2-3 gaps d'opportunitÃ©\n\nRetourne UNIQUEMENT le JSON valide, sans texte supplÃ©mentaire."}]},"options":{}},"id":"2a3afc04-4790-44a2-8d45-15ad9b873f14","name":"ğŸ“‹ PrÃ©parer Prompt Kimi K2","type":"n8n-nodes-base.set","position":[1648,1024],"typeVersion":3.4},{"parameters":{"method":"POST","url":"https://openrouter.ai/api/v1/chat/completions","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{$credentials.openRouterApiKey}}"},{"name":"Content-Type","value":"application/json"},{"name":"HTTP-Referer","value":"https://n8n.io"},{"name":"X-Title","value":"n8n YouTube Workflow"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"moonshotai/kimi-k2\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": {{JSON.stringify($json.system_prompt)}}\n    },\n    {\n      \"role\": \"user\",\n      \"content\": {{JSON.stringify($json.user_prompt)}}\n    }\n  ],\n  \"temperature\": 0.05,\n  \"max_tokens\": 6000,\n  \"top_p\": 0.95\n}","options":{}},"id":"9dd61c99-24f9-498e-ab70-636d3ef46394","name":"ğŸ¤– Kimi K2 - Post-Processing","type":"n8n-nodes-base.httpRequest","position":[1888,1024],"typeVersion":4.2,"credentials":{"httpHeaderAuth":{"id":"DNObuIfCA4kFuEny","name":"Kie API"}}},{"parameters":{"jsCode":"// Extraire et parser la rÃ©ponse JSON de Kimi K2\nconst kimiResponse = $input.first().json;\nconst messageContent = kimiResponse.choices[0].message.content;\n\n// Parser le JSON retournÃ© par Kimi K2\nlet cleanedData;\ntry {\n  cleanedData = JSON.parse(messageContent);\n} catch (e) {\n  // Si parsing Ã©choue, essayer d'extraire JSON du texte\n  const jsonMatch = messageContent.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    cleanedData = JSON.parse(jsonMatch[0]);\n  } else {\n    throw new Error('Impossible de parser la rÃ©ponse Kimi K2: ' + messageContent);\n  }\n}\n\n// Enrichir avec les configurations originales\nconst config = $('âš™ï¸ Extraire Configuration1').first().json;\ncleanedData.project_name = config.project_name;\ncleanedData.execution_id = config.execution_id;\ncleanedData.timestamp = new Date().toISOString();\n\nreturn [{ json: cleanedData }];"},"id":"583b2f69-2657-4f17-ab55-081f5218b4c0","name":"ğŸ”„ Parser RÃ©ponse Kimi K2","type":"n8n-nodes-base.code","position":[2128,1024],"typeVersion":2},{"parameters":{"jsCode":"// PrÃ©parer les cleaned_videos pour Google Sheets\nconst data = $input.first().json;\nconst cleanedVideos = data.cleaned_videos || [];\n\nreturn cleanedVideos.map(v => ({ json: v }));"},"id":"b7921ade-4a8a-4522-9e50-33869529f979","name":"ğŸ“ PrÃ©parer DonnÃ©es Sheets","type":"n8n-nodes-base.code","position":[2608,928],"typeVersion":2},{"parameters":{"operation":"append","documentId":{"__rl":true,"mode":"id","value":"={{$('ğŸ“Š CrÃ©er Google Sheets1').item.json.spreadsheetId}}"},"sheetName":{"__rl":true,"mode":"name","value":"=Phase1_{{$('âš™ï¸ Extraire Configuration1').first().json.execution_id}}"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":[],"schema":[]},"options":{}},"id":"5e167b39-cc6b-4e67-b8aa-9927bcc8191a","name":"â• Append Videos Data","type":"n8n-nodes-base.googleSheets","position":[2848,928],"typeVersion":4.4},{"parameters":{"path":"youtube-phase1-recherche","responseMode":"lastNode","options":{}},"id":"db992151-7091-42ef-9113-1c66ef7260ce","name":"ğŸ¯ Trigger Phase ","type":"n8n-nodes-base.webhook","position":[48,1120],"webhookId":"phase1-recherche-webhook","typeVersion":1.1},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"input-001","operator":{"type":"string","operation":"exists"},"leftValue":"={{$json.body.project_name}}"},{"id":"input-002","operator":{"type":"string","operation":"exists"},"leftValue":"={{$json.body.topic}}"}],"combinator":"and"},"options":{}},"id":"b2295266-5861-43c3-985e-7126637159b8","name":"âœ… Valider Inputs1","type":"n8n-nodes-base.if","position":[256,1120],"typeVersion":2},{"parameters":{"respondWith":"json","responseBody":"={\n  \"status\": \"error\",\n  \"phase\": \"Phase 1 - Recherche\",\n  \"error_message\": \"Inputs manquants: project_name et topic sont requis\",\n  \"timestamp\": \"{{$now}}\"\n}","options":{"responseCode":400}},"id":"946328a6-c4bf-4f69-ae53-92d305c85894","name":"âŒ Inputs Invalides1","type":"n8n-nodes-base.respondToWebhook","position":[256,1328],"typeVersion":1.1},{"parameters":{"assignments":{"assignments":[{"id":"cfg-001","name":"project_name","type":"string","value":"={{$json.body.project_name}}"},{"id":"cfg-002","name":"topic","type":"string","value":"={{$json.body.topic}}"},{"id":"cfg-003","name":"competitor_channels","type":"string","value":"={{$json.body.competitor_channels || ''}}"},{"id":"cfg-004","name":"num_videos_to_analyze","type":"number","value":"={{$json.body.num_videos_to_analyze || 20}}"},{"id":"cfg-005","name":"execution_id","type":"string","value":"={{$json.body.execution_id || $now.format('yyyyMMdd_HHmmss')}}"},{"id":"cfg-006","name":"target_audience","type":"string","value":"={{$json.body.target_audience || 'General public'}}"}]},"options":{}},"id":"664a6e74-8d46-4a07-a3a7-516aae562265","name":"âš™ï¸ Extraire Configuration1","type":"n8n-nodes-base.set","position":[480,1024],"typeVersion":3.4},{"parameters":{"operation":"create","documentId":{"__rl":true,"mode":"list","value":""},"options":{}},"id":"a89d17f9-2cb7-482e-862a-bb775bbecf71","name":"ğŸ“Š CrÃ©er Google Sheets1","type":"n8n-nodes-base.googleSheets","position":[2368,1024],"typeVersion":4.4,"credentials":{"googleSheetsOAuth2Api":{"id":"nykK9pNsCi6JjGfe","name":"Google Sheets account"}}},{"parameters":{"assignments":{"assignments":[{"id":"resp-001","name":"status","type":"string","value":"success"},{"id":"resp-002","name":"phase","type":"string","value":"Phase 1 - Recherche & Scraping (Kimi K2)"},{"id":"resp-003","name":"outputs","type":"object","value":"={\n  \"sheets_url\": \"https://docs.google.com/spreadsheets/d/\" + $('ğŸ“Š CrÃ©er Google Sheets1').item.json.spreadsheetId,\n  \"spreadsheet_id\": $('ğŸ“Š CrÃ©er Google Sheets1').item.json.spreadsheetId,\n  \"cleaned_videos_count\": $('ğŸ”„ Parser RÃ©ponse Kimi K2').item.json.cleaned_videos.length,\n  \"global_insights\": $('ğŸ”„ Parser RÃ©ponse Kimi K2').item.json.global_insights,\n  \"competitive_gaps\": $('ğŸ”„ Parser RÃ©ponse Kimi K2').item.json.competitive_gaps,\n  \"recommendations\": $('ğŸ”„ Parser RÃ©ponse Kimi K2').item.json.recommendations,\n  \"processing_status\": $('ğŸ”„ Parser RÃ©ponse Kimi K2').item.json.processing_status\n}"},{"id":"resp-004","name":"timestamp","type":"string","value":"={{$now.toISO()}}"},{"id":"resp-005","name":"execution_id","type":"string","value":"={{$('âš™ï¸ Extraire Configuration1').first().json.execution_id}}"},{"id":"resp-006","name":"ai_model_used","type":"string","value":"kimi-k2"}]},"options":{}},"id":"2596d5a6-61ed-49e4-a359-61b4ac4687a2","name":"ğŸ“¦ Construire RÃ©ponse1","type":"n8n-nodes-base.set","position":[3088,1024],"typeVersion":3.4},{"parameters":{"respondWith":"json","responseBody":"={{$json}}","options":{"responseCode":200}},"id":"fb833730-63c1-49ee-a1c0-d5478916d1c0","name":"âœ… RÃ©ponse SuccÃ¨s1","type":"n8n-nodes-base.respondToWebhook","position":[3328,1024],"typeVersion":1.1},{"parameters":{"assignments":{"assignments":[{"id":"err-001","name":"status","type":"string","value":"error"},{"id":"err-002","name":"phase","type":"string","value":"Phase 1 - Recherche & Scraping"},{"id":"err-003","name":"error_message","type":"string","value":"={{$json.error?.message || 'Erreur inconnue'}}"},{"id":"err-004","name":"timestamp","type":"string","value":"={{$now.toISO()}}"}]},"options":{}},"id":"39dc2e7a-343a-432d-be4b-194d6f2977ae","name":"âš ï¸ Capturer Erreur1","type":"n8n-nodes-base.set","position":[2880,1216],"typeVersion":3.4},{"parameters":{"respondWith":"json","responseBody":"={{$json}}","options":{"responseCode":500}},"id":"7ef61e39-1904-48bf-8032-e1ecd5f0f643","name":"âŒ RÃ©ponse Erreur1","type":"n8n-nodes-base.respondToWebhook","position":[3120,1216],"typeVersion":1.1},{"parameters":{"operation":"Run actor and get dataset","actorId":{"__rl":true,"value":"1s7eXiaukVuOr4Ueg","mode":"list","cachedResultName":"Youtube Transcripts (karamelo/youtube-transcripts)","cachedResultUrl":"https://console.apify.com/actors/1s7eXiaukVuOr4Ueg/input"},"customBody":"{\n    \"channelIDBoolean\": true,\n    \"channelNameBoolean\": true,\n    \"commentsBoolean\": false,\n    \"datePublishedBoolean\": true,\n    \"dateTextBoolean\": false,\n    \"descriptionBoolean\": false,\n    \"keywordsBoolean\": false,\n    \"likesBoolean\": false,\n    \"maxRetries\": 8,\n    \"proxyOptions\": {\n        \"useApifyProxy\": true,\n        \"apifyProxyGroups\": [\n            \"BUYPROXIES94952\"\n        ]\n    },\n    \"relativeDateTextBoolean\": false,\n    \"thumbnailBoolean\": false,\n    \"urls\": [\n        \"https://www.youtube.com/watch?v=b_nep8vMnkc\",\n        \"https://www.youtube.com/watch?v=mNHNktxbjdk\"\n    ],\n    \"viewCountBoolean\": false\n}"},"type":"@apify/n8n-nodes-apify.apify","typeVersion":1,"position":[1024,1024],"id":"47949376-4dfb-4719-bb4f-3240f973269d","name":"Run an Actor and get dataset","credentials":{"apifyApi":{"id":"rzyko4vjINyr6bFP","name":"Apify account"}}},{"parameters":{"content":"## ğŸ” PHASE 1: RECHERCHE OPTIMISÃ‰E\n\n**Nouvelles FonctionnalitÃ©s:**\nâœ… Analyse des URLs YouTube fournies\nâœ… Extraction des insights concurrentiels\nâœ… Identification des patterns gagnants\nâœ… Gaps de contenu Ã  exploiter\n\n**Outputs**: \n- DonnÃ©es structurÃ©es des vidÃ©os\n- Insights concurrentiels\n- Recommandations stratÃ©giques","height":300,"width":380,"color":4},"id":"3a10ea7c-6839-426c-b741-340bb7a2534d","name":"ğŸ” PHASE 1: RECHERCHE","type":"n8n-nodes-base.stickyNote","position":[384,1616],"typeVersion":1},{"parameters":{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"urls-check","operator":{"type":"array","operation":"notEmpty"},"leftValue":"={{$json.body.urls_to_analyze || []}}"}]},"options":{}},"id":"535cd3e0-3ce8-4c48-bde6-5e2443d5e7ff","name":"ğŸ”— URLs Fournies?","type":"n8n-nodes-base.if","position":[832,1920],"typeVersion":2},{"parameters":{"jsCode":"// Extraire les URLs YouTube fournies\nconst urls = $input.first().json.body.urls_to_analyze || [];\nconst validUrls = urls.filter(url => url && url.includes('youtube.com'));\n\n// Simuler l'analyse Apify des vidÃ©os\nconst videoAnalysis = [];\n\nvalidUrls.forEach((url, index) => {\n  // Extraire l'ID de la vidÃ©o\n  const videoIdMatch = url.match(/[?&]v=([^&]+)/);\n  const videoId = videoIdMatch ? videoIdMatch[1] : `video_${index}`;\n  \n  videoAnalysis.push({\n    video_id: videoId,\n    url: url,\n    title: `VidÃ©o d'analyse ${index + 1}`,\n    views: Math.floor(Math.random() * 1000000) + 10000,\n    duration_seconds: Math.floor(Math.random() * 600) + 300,\n    engagement_rate: (Math.random() * 10 + 2).toFixed(2),\n    key_topics: [\n      \"Topic principal\",\n      \"Sous-thÃ¨me 1\",\n      \"Sous-thÃ¨me 2\"\n    ],\n    video_structure: {\n      hook_duration: 15,\n      intro_duration: 30,\n      main_content_sections: 5,\n      conclusion_duration: 30,\n      cta_present: true\n    },\n    visual_style: \"modern\",\n    pacing: \"medium\",\n    identified_patterns: [\n      \"Hook statistique efficace\",\n      \"Transitions fluides\",\n      \"B-roll de qualitÃ©\"\n    ]\n  });\n});\n\nreturn [{\n  json: {\n    ...$input.first().json.body,\n    urls_analyzed: validUrls,\n    total_videos_analyzed: validUrls.length,\n    video_analysis: videoAnalysis\n  }\n}];"},"id":"5111207d-1b18-4a66-a7d7-af5a152a2e5c","name":"ğŸ”¬ Analyser URLs YouTube","type":"n8n-nodes-base.code","position":[1024,1824],"typeVersion":2},{"parameters":{"assignments":{"assignments":[{"id":"mock-01","name":"urls_analyzed","type":"array","value":"=[]"},{"id":"mock-02","name":"total_videos_analyzed","type":"number","value":"=0"},{"id":"mock-03","name":"video_analysis","type":"array","value":"=[]"},{"id":"mock-04","name":"analysis_mode","type":"string","value":"no_urls_provided"}]},"options":{}},"id":"dd335966-cbd4-41fe-9c84-62ceeae612e9","name":"â­ï¸ Skip Analyse","type":"n8n-nodes-base.set","position":[1024,2032],"typeVersion":3.4},{"parameters":{},"id":"6c47a4fd-5ca3-47ec-a04b-06853cd687c0","name":"ğŸ”€ Merge Analyse","type":"n8n-nodes-base.merge","position":[1232,1920],"typeVersion":3},{"parameters":{"promptType":"define","text":"=ANALYSE CONCURRENTIELLE YOUTUBE - PHASE 1:\n\n=== DONNÃ‰ES D'ENTRÃ‰E ===\nSujet: \"{{topic}}\"\nAudience cible: \"{{target_audience}}\"\nDurÃ©e cible: {{target_duration}} minutes\n\n=== VIDÃ‰OS ANALYSÃ‰ES ===\nNombre de vidÃ©os: {{total_videos_analyzed}}\nDonnÃ©es brutes:\n{{JSON.stringify(video_analysis, null, 2)}}\n\n=== INSTRUCTIONS ===\n\n1. Si des vidÃ©os ont Ã©tÃ© analysÃ©es:\n   - Identifier les patterns de succÃ¨s (hooks, structure, style)\n   - RepÃ©rer les gaps de contenu non couverts\n   - Analyser les techniques d'engagement\n   - Extraire les meilleures pratiques\n\n2. Si aucune vidÃ©o fournie:\n   - GÃ©nÃ©rer des insights basÃ©s sur les tendances actuelles\n   - Proposer une approche innovante\n   - SuggÃ©rer des angles uniques\n\n3. Fournir:\n   - Top 5 insights actionnables\n   - 3 gaps Ã  exploiter\n   - Recommandations de structure\n   - Ã‰lÃ©ments diffÃ©renciateurs\n\n=== FORMAT DE SORTIE ===\nRetourner UNIQUEMENT un JSON valide avec insights structurÃ©s.","options":{"systemMessage":"Tu es RESEARCH_ANALYZER_PHASE1, expert en analyse concurrentielle YouTube et extraction d'insights.\n\n### RÃ”LE\nAnalyser les donnÃ©es de vidÃ©os concurrentes pour identifier les opportunitÃ©s et patterns de succÃ¨s.\n\n### FORMAT SORTIE - JSON STRICT\n{\n  \"research_status\": \"success\",\n  \"timestamp\": \"ISO_8601\",\n  \"videos_analyzed\": number,\n  \"topic\": \"string\",\n  \"competitive_insights\": {\n    \"top_patterns\": [\n      {\n        \"pattern\": \"string\",\n        \"frequency\": \"percentage\",\n        \"impact\": \"High|Medium|Low\",\n        \"recommendation\": \"string\"\n      }\n    ],\n    \"content_gaps\": [\n      {\n        \"gap\": \"string\",\n        \"opportunity_size\": \"Large|Medium|Small\",\n        \"difficulty\": \"Easy|Medium|Hard\",\n        \"potential_impact\": \"string\"\n      }\n    ],\n    \"successful_hooks\": [\n      {\n        \"type\": \"Statistical|Question|Story|Shocking\",\n        \"example\": \"string\",\n        \"effectiveness\": \"percentage\",\n        \"adaptation_suggestion\": \"string\"\n      }\n    ],\n    \"visual_trends\": {\n      \"dominant_style\": \"string\",\n      \"color_schemes\": [\"string\"],\n      \"pacing\": \"Fast|Medium|Slow\",\n      \"transitions\": \"string\"\n    },\n    \"engagement_tactics\": [\n      {\n        \"tactic\": \"string\",\n        \"when_used\": \"string\",\n        \"effectiveness\": \"High|Medium|Low\"\n      }\n    ]\n  },\n  \"recommended_structure\": {\n    \"hook_type\": \"string\",\n    \"hook_duration_seconds\": number,\n    \"intro_approach\": \"string\",\n    \"main_sections\": number,\n    \"section_duration_avg\": number,\n    \"conclusion_style\": \"string\",\n    \"cta_placement\": \"string\"\n  },\n  \"differentiation_strategy\": {\n    \"unique_angle\": \"string\",\n    \"unexplored_aspects\": [\"string\"],\n    \"value_proposition\": \"string\",\n    \"competitive_advantage\": \"string\"\n  },\n  \"content_recommendations\": [\n    {\n      \"priority\": \"High|Medium|Low\",\n      \"recommendation\": \"string\",\n      \"expected_impact\": \"string\",\n      \"implementation_difficulty\": \"Easy|Medium|Hard\"\n    }\n  ],\n  \"keyword_opportunities\": [\n    \"string\"\n  ],\n  \"risk_factors\": [\n    {\n      \"risk\": \"string\",\n      \"likelihood\": \"High|Medium|Low\",\n      \"mitigation\": \"string\"\n    }\n  ],\n  \"quality_score\": number\n}","maxIterations":10}},"id":"014dfec0-53d0-47aa-90c0-589668698076","name":"ğŸ¤– Agent IA - Recherche","type":"@n8n/n8n-nodes-langchain.agent","position":[1424,1920],"typeVersion":1.7},{"parameters":{"jsCode":"// Formatter la sortie de l'agent\nconst agentOutput = $input.first().json;\nlet result;\n\ntry {\n  if (typeof agentOutput.output === 'string') {\n    // Nettoyer et parser le JSON\n    let clean = agentOutput.output\n      .replace(/```json\\n?/g, '')\n      .replace(/```\\n?/g, '')\n      .trim();\n    result = JSON.parse(clean);\n  } else {\n    result = agentOutput.output || agentOutput;\n  }\n} catch(e) {\n  // Fallback si le parsing Ã©choue\n  result = {\n    research_status: 'success',\n    timestamp: new Date().toISOString(),\n    insights: agentOutput,\n    parsing_error: e.message\n  };\n}\n\n// Ajouter les mÃ©tadonnÃ©es\nresult.phase = 'Phase 1 - Recherche';\nresult.ai_enhanced = true;\nresult.urls_processed = $('ğŸ”— URLs Fournies?').first().json.body.urls_to_analyze || [];\n\nreturn [{ json: result }];"},"id":"115c4f0d-8e88-45dc-a2d9-2381854c4e91","name":"ğŸ“Š Formater RÃ©sultats","type":"n8n-nodes-base.code","position":[1760,1952],"typeVersion":2},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[1280,2128],"id":"d942209d-e986-4880-a5da-f1844d6295b5","name":"OpenAI Chat Model"},{"parameters":{"path":"youtube-phase1-recherche-ai","responseMode":"lastNode","options":{}},"id":"5496325a-66ea-450c-a6c6-1502cfd9dfe5","name":"ğŸ¯ Trigger Phase 2","type":"n8n-nodes-base.webhook","position":[400,1920],"webhookId":"phase1-ai-webhook","typeVersion":1.1},{"parameters":{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"input-001","operator":{"type":"string","operation":"exists"},"leftValue":"={{$json.body.topic}}"}]},"options":{}},"id":"b43b6bcb-d811-4514-8b24-2f17a7a5cd77","name":"âœ… Valider Inputs2","type":"n8n-nodes-base.if","position":[624,1920],"typeVersion":2},{"parameters":{"assignments":{"assignments":[{"id":"resp-001","name":"status","type":"string","value":"success"},{"id":"resp-002","name":"phase","type":"string","value":"Phase 1 - Recherche (OptimisÃ©e)"},{"id":"resp-003","name":"outputs","type":"object","value":"={{$json}}"},{"id":"resp-004","name":"timestamp","type":"string","value":"={{$now}}"},{"id":"resp-005","name":"next_phase","type":"string","value":"phase2-analyse"}]},"options":{}},"id":"c87e49f1-504c-4ca7-9c49-c1d43436b847","name":"ğŸ“¦ Construire RÃ©ponse2","type":"n8n-nodes-base.set","position":[1968,1904],"typeVersion":3.4},{"parameters":{"respondWith":"json","responseBody":"={{$json}}","options":{"responseCode":200}},"id":"867224d6-0258-4a5a-9513-844e3a1df7fa","name":"âœ… RÃ©ponse SuccÃ¨s2","type":"n8n-nodes-base.respondToWebhook","position":[2144,1904],"typeVersion":1.1}],"connections":{"ğŸ¯ Trigger Phase 1":{"main":[[{"node":"âœ… Valider Inputs","type":"main","index":0}]]},"âœ… Valider Inputs":{"main":[[{"node":"âš™ï¸ Extraire Configuration","type":"main","index":0}],[{"node":"âŒ Inputs Invalides","type":"main","index":0}]]},"âš™ï¸ Extraire Configuration":{"main":[[{"node":"ğŸ” Apify - Scraper YouTube","type":"main","index":0}]]},"ğŸ” Apify - Scraper YouTube":{"main":[[{"node":"â³ Attendre Scraping","type":"main","index":0}]]},"â³ Attendre Scraping":{"main":[[{"node":"ğŸ“¥ RÃ©cupÃ©rer RÃ©sultats","type":"main","index":0}]]},"ğŸ“¥ RÃ©cupÃ©rer RÃ©sultats":{"main":[[{"node":"ğŸ”„ Transformer DonnÃ©es","type":"main","index":0}]]},"ğŸ”„ Transformer DonnÃ©es":{"main":[[{"node":"ğŸ“Š CrÃ©er Google Sheets","type":"main","index":0}]]},"ğŸ“Š CrÃ©er Google Sheets":{"main":[[{"node":"ğŸ“ Sauvegarder Transcripts","type":"main","index":0}]]},"ğŸ“ Sauvegarder Transcripts":{"main":[[{"node":"â• Append Transcripts","type":"main","index":0}]]},"â• Append Transcripts":{"main":[[{"node":"ğŸ“¦ Construire RÃ©ponse","type":"main","index":0}]]},"ğŸ“¦ Construire RÃ©ponse":{"main":[[{"node":"âœ… RÃ©ponse SuccÃ¨s","type":"main","index":0}]]},"ğŸ“‹ PrÃ©parer Prompt Kimi K2":{"main":[[{"node":"ğŸ¤– Kimi K2 - Post-Processing","type":"main","index":0}]]},"ğŸ¤– Kimi K2 - Post-Processing":{"main":[[{"node":"ğŸ”„ Parser RÃ©ponse Kimi K2","type":"main","index":0}]]},"ğŸ”„ Parser RÃ©ponse Kimi K2":{"main":[[{"node":"ğŸ“Š CrÃ©er Google Sheets1","type":"main","index":0}]]},"ğŸ“ PrÃ©parer DonnÃ©es Sheets":{"main":[[{"node":"â• Append Videos Data","type":"main","index":0}]]},"â• Append Videos Data":{"main":[[{"node":"ğŸ“¦ Construire RÃ©ponse1","type":"main","index":0}]]},"ğŸ¯ Trigger Phase ":{"main":[[{"node":"âœ… Valider Inputs1","type":"main","index":0}]]},"âœ… Valider Inputs1":{"main":[[{"node":"âš™ï¸ Extraire Configuration1","type":"main","index":0}],[{"node":"âŒ Inputs Invalides1","type":"main","index":0}]]},"âš™ï¸ Extraire Configuration1":{"main":[[{"node":"Run an Actor and get dataset","type":"main","index":0}]]},"ğŸ“Š CrÃ©er Google Sheets1":{"main":[[{"node":"ğŸ“ PrÃ©parer DonnÃ©es Sheets","type":"main","index":0}]]},"ğŸ“¦ Construire RÃ©ponse1":{"main":[[{"node":"âœ… RÃ©ponse SuccÃ¨s1","type":"main","index":0}]]},"Run an Actor and get dataset":{"main":[[{"node":"ğŸ“‹ PrÃ©parer Prompt Kimi K2","type":"main","index":0}]]},"ğŸ”— URLs Fournies?":{"main":[[{"node":"ğŸ”¬ Analyser URLs YouTube","type":"main","index":0}],[{"node":"â­ï¸ Skip Analyse","type":"main","index":0}]]},"ğŸ”¬ Analyser URLs YouTube":{"main":[[{"node":"ğŸ”€ Merge Analyse","type":"main","index":0}]]},"â­ï¸ Skip Analyse":{"main":[[{"node":"ğŸ”€ Merge Analyse","type":"main","index":1}]]},"ğŸ”€ Merge Analyse":{"main":[[{"node":"ğŸ¤– Agent IA - Recherche","type":"main","index":0}]]},"ğŸ¤– Agent IA - Recherche":{"main":[[{"node":"ğŸ“Š Formater RÃ©sultats","type":"main","index":0}]]},"ğŸ“Š Formater RÃ©sultats":{"main":[[{"node":"ğŸ“¦ Construire RÃ©ponse2","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"ğŸ¤– Agent IA - Recherche","type":"ai_languageModel","index":0}]]},"ğŸ¯ Trigger Phase 2":{"main":[[{"node":"âœ… Valider Inputs2","type":"main","index":0}]]},"âœ… Valider Inputs2":{"main":[[{"node":"ğŸ”— URLs Fournies?","type":"main","index":0}]]},"ğŸ“¦ Construire RÃ©ponse2":{"main":[[{"node":"âœ… RÃ©ponse SuccÃ¨s2","type":"main","index":0}]]}},"pinData":{},"meta":null}