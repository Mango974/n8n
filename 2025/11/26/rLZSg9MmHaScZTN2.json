{"nodes":[{"parameters":{},"id":"94ef3f7e-7451-425e-9d6d-d217c68854b5","name":"ğŸ¯ Execute Workflow Trigger","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1,"position":[-1616,-48]},{"parameters":{"content":"## ğŸ“¥ Scraping YouTube avec Apify\n\n**EntrÃ©es :**\n- projectId\n- urlYoutube\n- spreadsheetId\n\n**Actions :**\n1. Scraper vidÃ©o YouTube\n2. Extraire transcript\n3. Extraire miniatures\n4. Sauvegarder dans Sheets\n\n**Sorties :**\n- Transcripts nettoyÃ©s\n- MÃ©tadonnÃ©es vidÃ©o","height":380,"width":350,"color":5},"id":"af26bb45-d997-46af-a663-0b611d8aa63e","name":"ğŸ“¥ MODULE 1 - SCRAPING","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1664,-432]},{"parameters":{"resource":"spreadsheet","title":"scraping-yt","options":{}},"id":"bb982175-1e4b-480d-bbae-63bcebb3bea8","name":"ğŸ“Š Lire Config Projet","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-1376,-48],"credentials":{"googleSheetsOAuth2Api":{"id":"nykK9pNsCi6JjGfe","name":"Google Sheets account"}}},{"parameters":{"method":"POST","url":"https://api.apify.com/v2/acts/1s7eXiaukVuOr4Ueg/runs","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/json"},{"name":"Authorization","value":"Bearer <token>"}]},"sendBody":true,"specifyBody":"json","options":{"redirect":{"redirect":{}}}},"id":"72696872-b7d2-422b-9124-4e66282dba7e","name":"ğŸ” Apify - Scraper YouTube","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1136,-48],"credentials":{"httpHeaderAuth":{"id":"QwEE1sQT1wdLTSLR","name":"apify key"}}},{"parameters":{"amount":30},"id":"db299db9-50b6-48f2-8ce0-5a905c3bce1e","name":"â±ï¸ Attendre Fin Scraping","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-896,-48],"webhookId":"b4640ae6-7c72-437f-9df7-03d949a8d57a"},{"parameters":{"url":"={{ $node['ğŸ” Apify - Scraper YouTube'].json.data.defaultDatasetId ? 'https://api.apify.com/v2/datasets/' + $node['ğŸ” Apify - Scraper YouTube'].json.data.defaultDatasetId + '/items' : '' }}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","options":{}},"id":"5d2df62a-0265-449c-bcf6-e808f5410b22","name":"ğŸ“¥ RÃ©cupÃ©rer RÃ©sultats","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-656,-48],"credentials":{"httpHeaderAuth":{"id":"DNObuIfCA4kFuEny","name":"Header Auth account 2"}}},{"parameters":{"jsCode":"const items = $input.all();\nconst projectId = $('ğŸ¯ Execute Workflow Trigger').item.json.projectId;\nconst processedData = [];\n\nfor (const item of items) {\n  const data = item.json;\n  \n  if (data.transcript) {\n    // Nettoyer le transcript\n    const cleanTranscript = data.transcript\n      .replace(/\\[.*?\\]/g, '') // Enlever timestamps\n      .replace(/\\s+/g, ' ') // Normaliser espaces\n      .trim();\n    \n    processedData.push({\n      json: {\n        projectId: projectId,\n        videoId: data.videoId || '',\n        title: data.title || '',\n        transcript: cleanTranscript,\n        thumbnailUrl: data.thumbnails?.[0]?.url || '',\n        duration: data.duration || 0,\n        viewCount: data.viewCount || 0,\n        publishedAt: data.publishedAt || '',\n        scrapedAt: new Date().toISOString()\n      }\n    });\n  }\n}\n\nreturn processedData.length > 0 ? processedData : [{ \n  json: { \n    projectId: projectId,\n    error: 'No transcript found',\n    transcript: 'Transcript non disponible pour cette vidÃ©o'\n  } \n}];"},"id":"c1b9da87-59ac-430a-8084-e4d1a5c90161","name":"ğŸ§¹ Nettoyer Transcripts","type":"n8n-nodes-base.code","typeVersion":2,"position":[-416,-48]},{"parameters":{"resource":"spreadsheet","title":"scraping-yt","options":{}},"id":"30da3b1d-32d7-40cf-9471-9e864aa5028b","name":"ğŸ’¾ Sauvegarder Transcripts","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-176,-48],"credentials":{"googleSheetsOAuth2Api":{"id":"nykK9pNsCi6JjGfe","name":"Google Sheets account"}}},{"parameters":{"assignments":{"assignments":[{"id":"status","name":"status","type":"string","value":"success"},{"id":"module","name":"module","type":"string","value":"scraping"},{"id":"project-id","name":"projectId","type":"string","value":"={{ $('ğŸ¯ Execute Workflow Trigger').item.json.projectId }}"},{"id":"transcript-count","name":"transcriptsCount","type":"number","value":"={{ $('ğŸ§¹ Nettoyer Transcripts').all().length }}"},{"id":"message","name":"message","type":"string","value":"Scraping terminÃ© avec succÃ¨s"}]},"options":{}},"id":"b7f55d44-16b3-49e6-8c52-cc4c8d6a840a","name":"âœ… Retourner DonnÃ©es","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[64,-48]},{"parameters":{"content":"## Erreurs Possibles\n\n- Apify timeout\n- VidÃ©o privÃ©e\n- Pas de transcript\n- API rate limit\n\nEn cas d'erreur :\nRetourner message d'erreur\npour logging","height":200,"width":280,"color":7},"id":"f96aaba0-6c7d-423c-b4ba-6eba9020e962","name":"âš ï¸ Gestion d'Erreurs","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-432,192]},{"parameters":{"actorId":{"__rl":true,"mode":"list","value":""}},"type":"@apify/n8n-nodes-apify.apify","typeVersion":1,"position":[-1136,-272],"id":"9f2d5099-fcd8-48e8-a9ac-798195423916","name":"Run an Actor"}],"connections":{"ğŸ¯ Execute Workflow Trigger":{"main":[[{"node":"ğŸ“Š Lire Config Projet","type":"main","index":0}]]},"ğŸ“Š Lire Config Projet":{"main":[[{"node":"ğŸ” Apify - Scraper YouTube","type":"main","index":0}]]},"ğŸ” Apify - Scraper YouTube":{"main":[[{"node":"â±ï¸ Attendre Fin Scraping","type":"main","index":0}]]},"â±ï¸ Attendre Fin Scraping":{"main":[[{"node":"ğŸ“¥ RÃ©cupÃ©rer RÃ©sultats","type":"main","index":0}]]},"ğŸ“¥ RÃ©cupÃ©rer RÃ©sultats":{"main":[[{"node":"ğŸ§¹ Nettoyer Transcripts","type":"main","index":0}]]},"ğŸ§¹ Nettoyer Transcripts":{"main":[[{"node":"ğŸ’¾ Sauvegarder Transcripts","type":"main","index":0}]]},"ğŸ’¾ Sauvegarder Transcripts":{"main":[[{"node":"âœ… Retourner DonnÃ©es","type":"main","index":0}]]},"âœ… Retourner DonnÃ©es":{"main":[[]]}},"pinData":{},"meta":{"templateCredsSetupCompleted":true}}