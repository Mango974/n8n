{"nodes":[{"parameters":{},"id":"eebcee73-9f53-4c98-a1b3-9734e1716c60","name":"ğŸ¯ Execute Workflow Trigger","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1,"position":[208,304]},{"parameters":{"content":"## ğŸ¬ Assemblage Final\n\n**EntrÃ©es :**\n- projectId\n- SÃ©quences + images (Module 3)\n- Audio (Module 4)\n- Script (Module 2)\n\n**Actions :**\n1. Rassembler tous assets\n2. CrÃ©er script FFmpeg\n3. ExÃ©cuter assemblage\n4. CrÃ©er miniature YouTube\n5. GÃ©nÃ©rer description SEO\n6. Upload vidÃ©o finale\n7. Sauvegarder mÃ©tadonnÃ©es\n\n**Sorties :**\n- VidÃ©o finale MP4\n- Miniature\n- Description","height":480,"width":350},"id":"a20ee521-6e96-4037-befa-fcde18ec6211","name":"ğŸ¬ MODULE 5 - ASSEMBLAGE FINAL","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-48,-176]},{"parameters":{"operation":"getAll","documentId":{"__rl":true,"mode":"id","value":"={{ $json.spreadsheetId }}"}},"id":"dea9f29f-20a3-476a-a0a3-ec889edef0a7","name":"ğŸ“– Lire SÃ©quences","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[448,208]},{"parameters":{"operation":"getAll","documentId":{"__rl":true,"mode":"id","value":"={{ $json.spreadsheetId }}"}},"id":"a28f8984-d7b2-4adc-b168-af08c2815bb8","name":"ğŸµ Lire Audio","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[448,400]},{"parameters":{"operation":"getAll","documentId":{"__rl":true,"mode":"id","value":"={{ $json.spreadsheetId }}"}},"id":"0c0599de-fd14-4bed-8aa0-e5c26531cc3b","name":"ğŸ“ Lire Script","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[448,608]},{"parameters":{"mode":"combine","combineBy":"combineAll","options":{}},"id":"09ec5cdf-e3b9-4e0a-b7cf-dcb49f45b79b","name":"ğŸ”— Fusionner Tout","type":"n8n-nodes-base.merge","typeVersion":3,"position":[688,304]},{"parameters":{"jsCode":"const sequences = $('ğŸ“– Lire SÃ©quences').all().map(item => item.json);\nconst audio = $('ğŸµ Lire Audio').first().json;\nconst projectId = $('ğŸ¯ Execute Workflow Trigger').item.json.projectId;\n\n// Script FFmpeg complet\nconst ffmpegScript = `#!/bin/bash\n# Assemblage vidÃ©o - Project ${projectId}\n\nOUTPUT_DIR=\"/tmp/video_${projectId}\"\nFINAL_VIDEO=\"${OUTPUT_DIR}/final.mp4\"\n\nmkdir -p $OUTPUT_DIR\n\necho \"TÃ©lÃ©chargement assets...\"\n\n# TÃ©lÃ©charger audio\nwget -O \"${OUTPUT_DIR}/voiceover.mp3\" \"${audio.voiceoverUrl}\"\nwget -O \"${OUTPUT_DIR}/music.mp3\" \"${audio.musicUrl}\"\n\n# TÃ©lÃ©charger images\n${sequences.map(seq => \n  `wget -O \"${OUTPUT_DIR}/seq_${seq.sequenceId}.png\" \"${seq.imageUrl}\"`\n).join('\\n')}\n\necho \"Conversion images en vidÃ©o...\"\n${sequences.map(seq => \n  `ffmpeg -loop 1 -i \"${OUTPUT_DIR}/seq_${seq.sequenceId}.png\" -c:v libx264 -t ${seq.duration} -pix_fmt yuv420p -vf \"scale=1920:1080\" \"${OUTPUT_DIR}/seq_${seq.sequenceId}.mp4\"`\n).join('\\n')}\n\necho \"ConcatÃ©nation...\"\ncat > ${OUTPUT_DIR}/concat_list.txt << 'EOF'\n${sequences.map(seq => `file 'seq_${seq.sequenceId}.mp4'`).join('\\n')}\nEOF\n\nffmpeg -f concat -safe 0 -i ${OUTPUT_DIR}/concat_list.txt -c copy ${OUTPUT_DIR}/video_no_audio.mp4\n\necho \"Mixage audio...\"\nffmpeg -i ${OUTPUT_DIR}/voiceover.mp3 -i ${OUTPUT_DIR}/music.mp3 \\\\\n  -filter_complex \"[0:a]volume=1.0[a1];[1:a]volume=0.2[a2];[a1][a2]amix=inputs=2:duration=longest\" \\\\\n  ${OUTPUT_DIR}/mixed_audio.mp3\n\necho \"Assemblage final...\"\nffmpeg -i ${OUTPUT_DIR}/video_no_audio.mp4 -i ${OUTPUT_DIR}/mixed_audio.mp3 \\\\\n  -c:v copy -c:a aac -b:a 192k -shortest \\\\\n  $FINAL_VIDEO\n\necho \"âœ… VidÃ©o crÃ©Ã©e: $FINAL_VIDEO\"\n`;\n\nreturn [{\n  json: {\n    projectId: projectId,\n    ffmpegScript: ffmpegScript,\n    outputPath: `/tmp/video_${projectId}/final.mp4`\n  }\n}];"},"id":"24824031-1896-4167-a299-0a23ec8fed93","name":"âš™ï¸ CrÃ©er Script FFmpeg","type":"n8n-nodes-base.code","typeVersion":2,"position":[928,304]},{"parameters":{"jsCode":"// Note: Dans un environnement rÃ©el, utiliser MCP Server\n// Ici, simulation du rÃ©sultat\n\nconst projectId = $json.projectId;\nconst script = $json.ffmpegScript;\n\n// Simulation\nconst result = {\n  success: true,\n  projectId: projectId,\n  videoPath: $json.outputPath,\n  message: 'VidÃ©o assemblÃ©e (simulÃ©)',\n  implementationNote: 'Utiliser MCP Server ffmpeg ou bash_tool pour exÃ©cution rÃ©elle'\n};\n\nreturn [{ json: result }];"},"id":"b6733aaf-d2d9-480a-b0b3-1e56ef230473","name":"ğŸ¬ ExÃ©cuter FFmpeg (MCP)","type":"n8n-nodes-base.code","typeVersion":2,"position":[1168,304]},{"parameters":{"name":"={{ $('ğŸ¯ Execute Workflow Trigger').item.json.projectId + '_final.mp4' }}","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"mode":"list","value":"root","cachedResultName":"/ (Root folder)"},"options":{}},"id":"0f105269-e090-4ac5-8001-0ecd1695d608","name":"â˜ï¸ Drive - Upload VidÃ©o Finale","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1408,208]},{"parameters":{"method":"POST","url":"https://api.kie.ai/v1/images/generate","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"prompt\": \"YouTube thumbnail, professional, eye-catching: {{ $('ğŸ“ Lire Script').first().json.title }}, bold text, vibrant colors, 1280x720\",\n  \"model\": \"flux-pro\",\n  \"width\": 1280,\n  \"height\": 720,\n  \"output_format\": \"jpg\"\n}","options":{"response":{"response":{"responseFormat":"file"}}}},"id":"e3b104b0-4932-4f93-9153-dd00b2f7417a","name":"ğŸ–¼ï¸ Kie.ai - CrÃ©er Miniature","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1408,400]},{"parameters":{"name":"={{ $('ğŸ¯ Execute Workflow Trigger').item.json.projectId + '_thumbnail.jpg' }}","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"mode":"list","value":"root","cachedResultName":"/ (Root folder)"},"options":{}},"id":"aeaef655-6ebf-415f-b279-0eddf9524361","name":"â˜ï¸ Drive - Upload Miniature","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1648,400]},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/chat/completions","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"gpt-4\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"Tu es un expert YouTube SEO. CrÃ©e des descriptions optimisÃ©es avec timestamps et hashtags.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"CrÃ©e une description YouTube complÃ¨te pour:\\nTitre: {{ $('ğŸ“ Lire Script').first().json.title }}\\nDurÃ©e: {{ $('ğŸ“ Lire Script').first().json.wordCount * 0.5 }}s\\n\\nInclure: description accrocheuse, timestamps, 15-20 hashtags, call-to-action.\"\n    }\n  ],\n  \"temperature\": 0.7,\n  \"max_tokens\": 1000\n}","options":{}},"id":"1d27a22f-6edf-4773-81a2-9f9683233ed0","name":"ğŸ“ GPT-4 - Description YouTube","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1408,608]},{"parameters":{"jsCode":"const response = $json.choices[0].message.content;\nreturn [{ json: { description: response } }];"},"id":"72fb66f8-9955-45d0-aab1-fa8e7ff67e47","name":"ğŸ“‹ Parser Description","type":"n8n-nodes-base.code","typeVersion":2,"position":[1648,608]},{"parameters":{"operation":"append","documentId":{"__rl":true,"mode":"id","value":"={{ $('ğŸ¯ Execute Workflow Trigger').item.json.spreadsheetId }}"},"sheetName":{"__rl":true,"mode":"list","value":"Final_Videos"},"columns":{"mappingMode":"defineBelow","value":{"projectId":"={{ $('ğŸ¯ Execute Workflow Trigger').item.json.projectId }}","title":"={{ $('ğŸ“ Lire Script').first().json.title }}","videoUrl":"={{ $('â˜ï¸ Drive - Upload VidÃ©o Finale').first().json.webViewLink }}","thumbnailUrl":"={{ $('â˜ï¸ Drive - Upload Miniature').first().json.webViewLink }}","description":"={{ $('ğŸ“‹ Parser Description').first().json.description }}","status":"completed","completedAt":"={{ $now }}"}},"options":{}},"id":"2c088257-d561-4ae3-aec9-8375ebaa44cc","name":"ğŸ’¾ Sauvegarder MÃ©tadonnÃ©es Finales","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1888,400]},{"parameters":{"assignments":{"assignments":[{"id":"status","name":"status","type":"string","value":"success"},{"id":"module","name":"module","type":"string","value":"assembly"},{"id":"project-id","name":"projectId","type":"string","value":"={{ $('ğŸ¯ Execute Workflow Trigger').item.json.projectId }}"},{"id":"video-url","name":"videoUrl","type":"string","value":"={{ $('â˜ï¸ Drive - Upload VidÃ©o Finale').first().json.webViewLink }}"},{"id":"thumbnail-url","name":"thumbnailUrl","type":"string","value":"={{ $('â˜ï¸ Drive - Upload Miniature').first().json.webViewLink }}"}]},"options":{}},"id":"bd572e80-9b3d-4456-ade4-6072fef82917","name":"âœ… Retourner RÃ©sultat","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2128,400]}],"connections":{"ğŸ¯ Execute Workflow Trigger":{"main":[[{"node":"ğŸ“– Lire SÃ©quences","type":"main","index":0},{"node":"ğŸµ Lire Audio","type":"main","index":0},{"node":"ğŸ“ Lire Script","type":"main","index":0}]]},"ğŸ“– Lire SÃ©quences":{"main":[[{"node":"ğŸ”— Fusionner Tout","type":"main","index":0}]]},"ğŸµ Lire Audio":{"main":[[{"node":"ğŸ”— Fusionner Tout","type":"main","index":1}]]},"ğŸ”— Fusionner Tout":{"main":[[{"node":"âš™ï¸ CrÃ©er Script FFmpeg","type":"main","index":0}]]},"âš™ï¸ CrÃ©er Script FFmpeg":{"main":[[{"node":"ğŸ¬ ExÃ©cuter FFmpeg (MCP)","type":"main","index":0}]]},"ğŸ¬ ExÃ©cuter FFmpeg (MCP)":{"main":[[{"node":"â˜ï¸ Drive - Upload VidÃ©o Finale","type":"main","index":0},{"node":"ğŸ–¼ï¸ Kie.ai - CrÃ©er Miniature","type":"main","index":0},{"node":"ğŸ“ GPT-4 - Description YouTube","type":"main","index":0}]]},"â˜ï¸ Drive - Upload VidÃ©o Finale":{"main":[[{"node":"ğŸ’¾ Sauvegarder MÃ©tadonnÃ©es Finales","type":"main","index":0}]]},"ğŸ–¼ï¸ Kie.ai - CrÃ©er Miniature":{"main":[[{"node":"â˜ï¸ Drive - Upload Miniature","type":"main","index":0}]]},"â˜ï¸ Drive - Upload Miniature":{"main":[[{"node":"ğŸ’¾ Sauvegarder MÃ©tadonnÃ©es Finales","type":"main","index":0}]]},"ğŸ“ GPT-4 - Description YouTube":{"main":[[{"node":"ğŸ“‹ Parser Description","type":"main","index":0}]]},"ğŸ“‹ Parser Description":{"main":[[{"node":"ğŸ’¾ Sauvegarder MÃ©tadonnÃ©es Finales","type":"main","index":0}]]},"ğŸ’¾ Sauvegarder MÃ©tadonnÃ©es Finales":{"main":[[{"node":"âœ… Retourner RÃ©sultat","type":"main","index":0}]]}},"pinData":{},"meta":null}