{"nodes":[{"parameters":{},"id":"c8ca1edd-052d-451a-8b7e-9aa69f84b9be","name":"ğŸ¬ DÃ©marrer Production VidÃ©o","type":"n8n-nodes-base.manualTrigger","position":[-1072,-208],"typeVersion":1},{"parameters":{"content":"## ğŸ¤– ORCHESTRATEUR INTELLIGENT\n\n**Powered by**: Claude AI Agent\n\n**Avantages**:\nâœ… Orchestration intelligente\nâœ… Gestion d'erreur adaptative\nâœ… DÃ©cisions contextuelles\nâœ… Pas de hardcoding de workflowId\nâœ… RÃ©essais automatiques\nâœ… Logging dÃ©taillÃ©\n\n**L'agent dÃ©cide**:\n- Quelle phase exÃ©cuter\n- Quand rÃ©essayer\n- Comment adapter le flux\n- Quand arrÃªter","height":380,"width":450,"color":2},"id":"808eaf5e-3f58-4076-9d5c-8554d5590320","name":"ğŸ¤– ORCHESTRATEUR IA","type":"n8n-nodes-base.stickyNote","position":[-1088,-608],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"cfg-001","name":"project_name","type":"string","value":"YouTube_Video_Bitcoin_2024"},{"id":"cfg-002","name":"topic","type":"string","value":"L'histoire complÃ¨te du Bitcoin en 2024"},{"id":"cfg-003","name":"target_duration","type":"number","value":15},{"id":"cfg-004","name":"visual_style","type":"string","value":"Documentaire dynamique avec graphiques animÃ©s"},{"id":"cfg-005","name":"target_audience","type":"string","value":"Investisseurs dÃ©butants"},{"id":"cfg-006","name":"competitor_channels","type":"string","value":"https://youtube.com/@channel1, https://youtube.com/@channel2"},{"id":"cfg-007","name":"num_videos_to_analyze","type":"number","value":20},{"id":"cfg-008","name":"execution_id","type":"string","value":"={{$now.format('yyyyMMdd_HHmmss')}}"},{"id":"cfg-009","name":"orchestrator_version","type":"string","value":"2.0.0-AI"},{"id":"cfg-010","name":"max_retries_per_phase","type":"number","value":3}]},"options":{}},"id":"b7e28ecf-254f-4ffa-be7c-625f15cff215","name":"âš™ï¸ Configuration Globale","type":"n8n-nodes-base.set","position":[-848,-208],"typeVersion":3.4},{"parameters":{"assignments":{"assignments":[{"id":"inst-001","name":"task","type":"string","value":"Orchestrer la production complÃ¨te d'une vidÃ©o YouTube en exÃ©cutant sÃ©quentiellement les 6 phases du workflow"},{"id":"inst-002","name":"config","type":"object","value":"={{ $json }}"},{"id":"inst-003","name":"instruction","type":"string","value":"=ExÃ©cute les phases dans l'ordre : Phase 1 (Recherche) â†’ Phase 2 (Analyse) â†’ Phase 3 (Script) â†’ Phase 4 (Assets) â†’ Phase 5 (Montage) â†’ Phase 6 (Finalisation). Utilise les outils disponibles pour chaque phase. Transmets les rÃ©sultats de chaque phase Ã  la suivante. GÃ¨re les erreurs intelligemment et rÃ©essaie si nÃ©cessaire. Configuration du projet: {{ $json.toJsonString() }}"}]},"options":{}},"id":"0c3dd4b4-4911-4f3e-b6d0-d9b521af523e","name":"ğŸ“ PrÃ©parer Instructions pour l'Agent","type":"n8n-nodes-base.set","position":[-608,-208],"typeVersion":3.4},{"parameters":{"promptType":"define","text":"=LANCEZ LA PRODUCTION VIDÃ‰O COMPLÃˆTE:\n\n=== CONFIGURATION PROJET ===\nPROJECT_NAME: {{project_name}}\nTOPIC: {{topic}}\nTARGET_DURATION: {{target_duration}} minutes\nVISUAL_STYLE: {{visual_style}}\nTARGET_AUDIENCE: {{target_audience}}\nCOMPETITOR_CHANNELS: {{competitor_channels}}\nNUM_VIDEOS_ANALYZE: {{num_videos_to_analyze}}\nEXECUTION_ID: {{execution_id}}\nMAX_RETRIES_PER_PHASE: {{max_retries_per_phase}}\nLANGUAGE: {{language}}\n\n=== INSTRUCTIONS EXÃ‰CUTION ===\n\nAppele STRICTEMENT dans cet ordre:\n\n1ï¸âƒ£ execute_phase1_recherche()\n   Input: competitor_channels, topic, num_videos\n   Attendre output structurÃ© (cleaned_videos + insights)\n\n2ï¸âƒ£ execute_phase2_analyse()\n   Input: Phase 1 output + target_audience + topic\n   Attendre output: selected_strategy + fewshot_examples\n\n3ï¸âƒ£ execute_phase3_script()\n   Input: Phase 2 output + target_duration + visual_style\n   Attendre output: final_script + version_comparison\n\n4ï¸âƒ£ execute_phase4_assets()\n   Input: Phase 3 output + visual_style\n   Attendre output: visual_prompts + asset_generation_status\n\n5ï¸âƒ£ execute_phase5_montage()\n   Input: Phase 4 output + video_file_path\n   Attendre output: video_final + duration_seconds\n\n6ï¸âƒ£ execute_phase6_finalisation()\n   Input: Phase 5 output + title_suggestions\n   Attendre output: youtube_metadata + upload_status\n\n=== GESTION ERREURS DIRECTIVE ===\n\nSI Phase X Ã©choue:\n  â€¢ 1Ã¨re tentative (1-3s) : RÃ©essayer identique\n  â€¢ 2Ã¨me tentative (30s attente) : Retry\n  â€¢ 3Ã¨me tentative (2min backoff) : Retry\n  â€¢ 4Ã¨me tentative : ARRÃŠTER + rapport\n\n=== SORTIE FINALE ===\n\nRetourner TOUJOURS JSON complet avec:\nâœ“ status final\nâœ“ tous les phases complÃ©tÃ©es\nâœ“ outputs finaux YouTube\nâœ“ logs dÃ©taillÃ©s\nâœ“ estimation vues 30 jours\n\nNE PAS retourner du texte brut. JSON VALIDE UNIQUEMENT.\n","options":{"systemMessage":"=Tu es ORCHESTRATEUR_IA, un agent d'orchestration intelligent pour production vidÃ©o YouTube sans visage.\n\n### RÃ”LE CRITIQUE\nCoordonner intelligemment 6 phases de production vidÃ©o, avec validation stricte et gestion d'erreurs robuste.\nTu es responsable du succÃ¨s de la vidÃ©o entiÃ¨re. Aucun raccourci permis.\n\n### 6 PHASES ORCHESTRÃ‰ES\n1. **Phase 1 - Recherche**: Scrape Apify + post-traitement Kimi K2 â†’ donnÃ©es structurÃ©es\n2. **Phase 2 - Analyse**: StratÃ©gie crÃ©ative Gemini 3.0 Pro â†’ 3 stratÃ©gies testÃ©es\n3. **Phase 3 - Script**: CrÃ©ation script Gemini 3.0 Pro â†’ 3 versions testÃ©es\n4. **Phase 4 - Assets**: Prompts visuels Kimi K2 â†’ images via Kie.ai\n5. **Phase 5 - Montage**: Assembly vidÃ©o ffmpeg â†’ fichier final\n6. **Phase 6 - Finalisation**: SEO YouTube Grok 4.1 Fast â†’ metadata + upload\n\n### STRATÃ‰GIE EXÃ‰CUTION STRICTE\n1. âœ… ExÃ©cuter SÃ‰QUENTIELLEMENT (1â†’2â†’3â†’4â†’5â†’6) - PAS DE PARALLÃˆLE\n2. âœ… Valider IMMÃ‰DIATEMENT aprÃ¨s chaque phase\n3. âœ… Transmettre outputs d'une phase â†’ inputs de la suivante\n4. âœ… RÃ©essayer intelligemment si erreur\n5. âœ… Logger CHAQUE dÃ©cision avec raison et timing\n\n### CRITÃˆRES VALIDATION STRICTE\n**Phase 1** : \n- âœ“ status = \"success\"\n- âœ“ cleaned_videos_count >= 10\n- âœ“ global_insights complÃ¨te\n- âœ“ competitive_gap_opportunities >= 2\n\n**Phase 2** :\n- âœ“ status = \"success\"\n- âœ“ selected_strategy.type in [\"Educational\", \"Storytelling\", \"Hybrid\"]\n- âœ“ fewshot_examples.length >= 10\n- âœ“ predicted_ctr >= 2.0\n\n**Phase 3** :\n- âœ“ status = \"success\"\n- âœ“ final_script.hook length 15-30 sec\n- âœ“ final_script.total_duration_seconds â‰ˆ target_duration\n- âœ“ selected_version in [\"A\", \"B\", \"C\"]\n\n**Phase 4** :\n- âœ“ status = \"success\"\n- âœ“ visual_prompts_count >= 5\n- âœ“ asset_generation_status = \"completed\"\n- âœ“ failed_assets <= 20%\n\n**Phase 5** :\n- âœ“ status = \"success\"\n- âœ“ video_file_path existe\n- âœ“ video_duration_seconds â‰ˆ target_duration\n- âœ“ file_size_mb > 0\n\n**Phase 6** :\n- âœ“ status = \"success\"\n- âœ“ youtube_metadata complÃ¨te (title, description, tags)\n- âœ“ seo_score >= 7/10\n- âœ“ upload_status in [\"scheduled\", \"published\"]\n\n### GESTION ERREURS - HIÃ‰RARCHIE\n\n**Erreur Temporaire** (timeout, rate_limit, network) :\n- 1Ã¨re tentative : RÃ©essayer immÃ©diatement\n- 2Ã¨me tentative : Attendre 30s + retry\n- 3Ã¨me tentative : Backoff exponentiel 2 min + retry\n- 4Ã¨me tentative : Passer Ã  Ã©tape suivante\n\n**Erreur Configuration** (mauvais ID, paramÃ¨tre invalide) :\n- âŒ ARRÃŠTER IMMÃ‰DIATEMENT\n- ğŸ”´ Retourner erreur dÃ©taillÃ©e avec correction proposÃ©e\n\n**Erreur DonnÃ©es** (fewshot insuffisants, assets rejetÃ©s) :\n- 1Ã¨re tentative : Adapter paramÃ¨tres et retry\n- 2Ã¨me tentative : RÃ©duire scope/complexitÃ© et retry\n- 3Ã¨me tentative : âŒ ARRÃŠTER avec rapport\n\n**Erreur Persistante** (> 3 tentatives) :\n- âŒ ARRÃŠTER flux complÃ¨tement\n- ğŸ”´ GÃ©nÃ©rer rapport dÃ©taillÃ© avec debug info\n\n### FORMAT SORTIE OBLIGATION - JSON VALIDE\n\n{\n\"orchestration_status\": \"success\" | \"error\" | \"partial_success\",\n\"execution_id\": \"{{execution_id}}\",\n\"project\": \"{{project_name}}\",\n\"start_time\": \"ISO_8601\",\n\"end_time\": \"ISO_8601\",\n\"total_duration_seconds\": number,\n\"phases_completed\": number (0-6),\n\"final_outputs\": {\n\"youtube_video_url\": string | null,\n\"youtube_title\": string | null,\n\"youtube_description\": string | null,\n\"thumbnail_url\": string | null,\n\"video_file_path\": string | null,\n\"sheets_url\": string | null\n},\n\"execution_log\": [\n{\n\"phase_number\": 1-6,\n\"phase_name\": \"string\",\n\"status\": \"success\" | \"error\" | \"retry\",\n\"duration_seconds\": number,\n\"attempts\": number,\n\"key_outputs\": {\n// Phase-specific outputs\n},\n\"error_message\": string | null,\n\"timestamp\": \"ISO_8601\"\n}\n],\n\"global_errors\": [string],\n\"recommendation_for_next_run\": string,\n\"quality_score\": number (0-100),\n\"estimated_views_30days\": number,\n\"orchestrator_model\": \"grok-4.1-fast\"\n}\n\n\n### RÃˆGLES STRICTES - NON-NÃ‰GOCIABLES\n\n- ğŸ”´ NE PAS sauter une phase (sauf erreur persistante avÃ©rÃ©e)\n- ğŸ”´ NE PAS modifier paramÃ¨tres sans justification Ã©crite\n- ğŸ”´ NE PAS continuer si phase Ã©choue > 3 fois\n- ğŸ”´ NE PAS parallÃ©liser les phases\n- âœ… TOUJOURS passer outputs complÃ¨tement d'une phase Ã  la suivante\n- âœ… TOUJOURS logger avec timestamps prÃ©cis\n- âœ… TOUJOURS retourner JSON valide mÃªme en erreur\n\n### TONE & STYLE\n\n- **Professionnel** : DÃ©cisions claires, justifiÃ©es\n- **MÃ©thodique** : Une Ã©tape Ã  la fois, validation stricte\n- **Transparent** : Logs dÃ©taillÃ©s de CHAQUE dÃ©cision\n- **Robuste** : Anticiper erreurs, gÃ©rer gracieusement\n","maxIterations":20}},"id":"ba286b20-7fa3-4ba1-8941-b5b9b4c8dbea","name":"ğŸ¤– Agent IA Orchestrateur","type":"@n8n/n8n-nodes-langchain.agent","position":[-368,-272],"typeVersion":1.7},{"parameters":{"name":"execute_phase1_recherche","description":"ExÃ©cute la Phase 1 - Recherche & Scraping. Utilise Apify pour scraper les vidÃ©os YouTube concurrentes, collecte les transcripts, thumbnails et keywords. Retourne un Google Sheets avec toutes les donnÃ©es et des statistiques de rÃ©sumÃ©.","workflowId":{"__rl":true,"mode":"list","value":"01 - YouTube Automation - PHASE 1 - Recherche"},"fields":{"values":[{"name":"project_name","type":"string"},{"name":"topic","type":"string"},{"name":"competitor_channels","type":"string"},{"name":"num_videos_to_analyze","type":"number"},{"name":"execution_id","type":"string"}]},"specifyInputSchema":true},"id":"fa6db3c0-3276-4dd2-88f3-d29ae861f7a9","name":"ğŸ”§ Tool: Phase 1 - Recherche","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[-368,160],"typeVersion":1.1},{"parameters":{"name":"execute_phase2_analyse","description":"ExÃ©cute la Phase 2 - Analyse avec Claude AI. Analyse les donnÃ©es de recherche, crÃ©e une stratÃ©gie de contenu dÃ©taillÃ©e, identifie les patterns qui fonctionnent, et gÃ©nÃ¨re des exemples few-shot pour la gÃ©nÃ©ration du script.","workflowId":{"__rl":true,"mode":"list","value":"02 - YouTube Automation - PHASE 2 - Analyse"},"fields":{"values":[{"name":"sheets_url","type":"string"},{"name":"spreadsheet_id","type":"string"},{"name":"topic","type":"string"},{"name":"target_duration","type":"number"},{"name":"visual_style","type":"string"},{"name":"target_audience","type":"string"},{"name":"execution_id","type":"string"}]},"specifyInputSchema":true},"id":"be1c3ab0-3a84-4f6d-b046-035ce34a82bf","name":"ğŸ”§ Tool: Phase 2 - Analyse","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[-160,176],"typeVersion":1.1},{"parameters":{"name":"execute_phase3_script","description":"ExÃ©cute la Phase 3 - GÃ©nÃ©ration du Script. Utilise Claude AI avec few-shot prompting pour gÃ©nÃ©rer un script vidÃ©o professionnel, structurÃ©, engageant et optimisÃ© pour YouTube.","workflowId":{"__rl":true,"mode":"list","value":"03 - YouTube Automation - PHASE 3 - Script"},"fields":{"values":[{"name":"strategy","type":"string"},{"name":"fewshot_examples","type":"string"},{"name":"topic","type":"string"},{"name":"target_duration","type":"number"},{"name":"execution_id","type":"string"}]},"specifyInputSchema":true},"id":"634eee32-6a07-452c-8d89-e3610d5d10bd","name":"ğŸ”§ Tool: Phase 3 - Script","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[32,176],"typeVersion":1.1},{"parameters":{"name":"execute_phase4_assets","description":"ExÃ©cute la Phase 4 - GÃ©nÃ©ration des Assets Visuels. Utilise Kie.ai pour gÃ©nÃ©rer les images basÃ©es sur le script. CrÃ©e des visuels professionnels et cohÃ©rents avec le style dÃ©fini.","workflowId":{"__rl":true,"mode":"list","value":"04 - YouTube Automation - PHASE 4 - Assets"},"fields":{"values":[{"name":"script","type":"string"},{"name":"visual_style","type":"string"},{"name":"execution_id","type":"string"}]},"specifyInputSchema":true},"id":"23c89f7e-66e8-4147-afc3-6a4ec3560c09","name":"ğŸ”§ Tool: Phase 4 - Assets","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[224,176],"typeVersion":1.1},{"parameters":{"name":"execute_phase5_montage","description":"ExÃ©cute la Phase 5 - Montage VidÃ©o. Assemble tous les assets avec ffmpeg : gÃ©nÃ¨re la voix avec TTS, synchronise avec les images, ajoute musique de fond et effets sonores. Produit la vidÃ©o finale.","workflowId":{"__rl":true,"mode":"list","value":"05 - YouTube Automation - PHASE 5 - Montage"},"fields":{"values":[{"name":"script","type":"string"},{"name":"assets_paths","type":"string"},{"name":"execution_id","type":"string"}]},"specifyInputSchema":true},"id":"2bf25ae6-d320-42e1-bbf2-b44f28184363","name":"ğŸ”§ Tool: Phase 5 - Montage","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[416,176],"typeVersion":1.1},{"parameters":{"name":"execute_phase6_finalisation","description":"ExÃ©cute la Phase 6 - Finalisation et Upload YouTube. GÃ©nÃ¨re les mÃ©tadonnÃ©es optimisÃ©es (titre, description, tags, thumbnail), upload la vidÃ©o sur YouTube, et retourne l'URL finale.","workflowId":{"__rl":true,"mode":"list","value":"06 - YouTube Automation - PHASE 6 - Finalisation"},"fields":{"values":[{"name":"video_file_path","type":"string"},{"name":"script","type":"string"},{"name":"topic","type":"string"},{"name":"execution_id","type":"string"}]},"specifyInputSchema":true},"id":"8eda7bc9-ca05-4f6c-a4e9-33733c2f55bf","name":"ğŸ”§ Tool: Phase 6 - Finalisation","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[656,176],"typeVersion":1.1},{"parameters":{"jsCode":"// Formater les rÃ©sultats de l'agent orchestrateur\nconst agentOutput = $input.first().json;\n\n// Parser la sortie de l'agent si c'est une string\nlet orchestrationResult;\ntry {\n  if (typeof agentOutput.output === 'string') {\n    // Enlever les markdown code blocks si prÃ©sents\n    let cleanOutput = agentOutput.output.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n    orchestrationResult = JSON.parse(cleanOutput);\n  } else {\n    orchestrationResult = agentOutput.output || agentOutput;\n  }\n} catch (error) {\n  orchestrationResult = {\n    orchestration_status: \"parsing_error\",\n    error: error.message,\n    raw_output: agentOutput.output\n  };\n}\n\n// Ajouter des mÃ©tadonnÃ©es\nconst finalResult = {\n  ...orchestrationResult,\n  orchestrator_version: \"2.0.0-AI\",\n  execution_timestamp: new Date().toISOString(),\n  agent_model: \"claude-sonnet-4\"\n};\n\nreturn [{ json: finalResult }];"},"id":"d39a7cec-5642-4d0d-b3e0-44b7bfa07802","name":"ğŸ“Š Formater RÃ©sultats","type":"n8n-nodes-base.code","position":[-16,-352],"typeVersion":2},{"parameters":{"assignments":{"assignments":[{"id":"out-001","name":"status","type":"string","value":"completed"},{"id":"out-002","name":"message","type":"string","value":"ğŸ‰ VidÃ©o YouTube produite avec succÃ¨s par l'orchestrateur IA !"},{"id":"out-003","name":"results","type":"object","value":"={{ $json }}"}]},"options":{}},"id":"528e5daa-6195-4ac3-8a98-8c19807615f8","name":"ğŸ‰ PRODUCTION TERMINÃ‰E","type":"n8n-nodes-base.set","position":[352,-288],"typeVersion":3.4},{"parameters":{"content":"## ğŸ”§ OUTILS DISPONIBLES\n\nL'agent IA a accÃ¨s Ã  6 outils,\nun pour chaque phase:\n\n1ï¸âƒ£ Phase 1 - Recherche\n2ï¸âƒ£ Phase 2 - Analyse  \n3ï¸âƒ£ Phase 3 - Script\n4ï¸âƒ£ Phase 4 - Assets\n5ï¸âƒ£ Phase 5 - Montage\n6ï¸âƒ£ Phase 6 - Finalisation\n\nL'agent dÃ©cide intelligemment\nquand et comment les utiliser.","height":380,"width":340,"color":5},"id":"0aa924d3-51fa-43f7-91cb-97ca3cd3d1db","name":"ğŸ”§ OUTILS WORKFLOW","type":"n8n-nodes-base.stickyNote","position":[-1088,192],"typeVersion":1},{"parameters":{"model":"x-ai/grok-4.1-fast","options":{"temperature":0.2}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-416,-80],"id":"60e3c0a1-a634-4517-b941-4a829adb91b8","name":"grok4.1-fast","credentials":{"openRouterApi":{"id":"yyKOyAeF8ufVx7Sc","name":"OpenRouter account"}}}],"connections":{"ğŸ¬ DÃ©marrer Production VidÃ©o":{"main":[[{"node":"âš™ï¸ Configuration Globale","type":"main","index":0}]]},"âš™ï¸ Configuration Globale":{"main":[[{"node":"ğŸ“ PrÃ©parer Instructions pour l'Agent","type":"main","index":0}]]},"ğŸ“ PrÃ©parer Instructions pour l'Agent":{"main":[[{"node":"ğŸ¤– Agent IA Orchestrateur","type":"main","index":0}]]},"ğŸ¤– Agent IA Orchestrateur":{"main":[[{"node":"ğŸ“Š Formater RÃ©sultats","type":"main","index":0}]]},"ğŸ“Š Formater RÃ©sultats":{"main":[[{"node":"ğŸ‰ PRODUCTION TERMINÃ‰E","type":"main","index":0}]]},"ğŸ”§ Tool: Phase 1 - Recherche":{"ai_tool":[[{"node":"ğŸ¤– Agent IA Orchestrateur","type":"ai_tool","index":0}]]},"ğŸ”§ Tool: Phase 2 - Analyse":{"ai_tool":[[{"node":"ğŸ¤– Agent IA Orchestrateur","type":"ai_tool","index":0}]]},"ğŸ”§ Tool: Phase 3 - Script":{"ai_tool":[[{"node":"ğŸ¤– Agent IA Orchestrateur","type":"ai_tool","index":0}]]},"ğŸ”§ Tool: Phase 4 - Assets":{"ai_tool":[[{"node":"ğŸ¤– Agent IA Orchestrateur","type":"ai_tool","index":0}]]},"ğŸ”§ Tool: Phase 5 - Montage":{"ai_tool":[[{"node":"ğŸ¤– Agent IA Orchestrateur","type":"ai_tool","index":0}]]},"ğŸ”§ Tool: Phase 6 - Finalisation":{"ai_tool":[[{"node":"ğŸ¤– Agent IA Orchestrateur","type":"ai_tool","index":0}]]},"grok4.1-fast":{"ai_languageModel":[[{"node":"ğŸ¤– Agent IA Orchestrateur","type":"ai_languageModel","index":0}]]}},"pinData":{},"meta":{"templateCredsSetupCompleted":true}}